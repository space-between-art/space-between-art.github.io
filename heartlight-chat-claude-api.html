<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒå…‰è«®è©¢å®¤ | Space Between Art</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --forest-green: #2C5F2D;
            --forest-dark: #1A3A1B;
            --forest-light: #4A7C4B;
            --warm-gold: #D4A84B;
            --gold-light: #E8C97A;
            --cream: #FDF8F3;
            --cream-dark: #F5EDE4;
            --text-dark: #2A2A2A;
            --text-muted: #6B6B6B;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, var(--forest-dark) 0%, var(--forest-green) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .chat-container {
            width: 100%;
            max-width: 500px;
            background: var(--cream);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }

        .chat-header {
            background: var(--forest-green);
            color: white;
            padding: 1.2rem;
            text-align: center;
            flex-shrink: 0;
        }

        .chat-header h1 {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.4rem;
            color: var(--gold-light);
            margin-bottom: 0.2rem;
        }

        .chat-header p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        .character-select {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            padding: 0.8rem;
            background: var(--cream-dark);
            flex-shrink: 0;
        }

        .character-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--forest-green);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .character-btn.active {
            background: var(--forest-green);
            color: white;
        }

        .character-btn:hover:not(.active) {
            background: var(--cream);
        }

        .character-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            object-fit: cover;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            min-height: 300px;
        }

        .message {
            max-width: 85%;
            padding: 0.9rem 1rem;
            border-radius: 16px;
            line-height: 1.6;
            animation: fadeIn 0.3s ease;
            font-size: 0.95rem;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot {
            background: white;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .message.user {
            background: var(--forest-green);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .message .sender {
            font-size: 0.7rem;
            color: var(--warm-gold);
            margin-bottom: 0.3rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .message.user .sender {
            color: var(--gold-light);
            justify-content: flex-end;
        }

        .message .content {
            white-space: pre-wrap;
        }

        .plant-card {
            background: var(--cream);
            padding: 0.8rem;
            border-radius: 10px;
            margin-top: 0.8rem;
            border-left: 3px solid var(--warm-gold);
        }

        .plant-card .name {
            font-family: 'Noto Serif TC', serif;
            color: var(--forest-green);
            font-size: 0.95rem;
        }

        .plant-card .effect {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.2rem;
        }

        .typing-indicator {
            display: none;
            padding: 0.8rem 1rem;
            color: var(--text-muted);
            font-size: 0.85rem;
            align-self: flex-start;
        }

        .typing-indicator.active {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--forest-green);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .quick-prompts {
            padding: 0.6rem 1rem;
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
            background: var(--cream-dark);
            flex-shrink: 0;
        }

        .quick-prompt {
            padding: 0.35rem 0.7rem;
            background: white;
            border: 1px solid var(--cream-dark);
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-prompt:hover {
            background: var(--forest-green);
            color: white;
            border-color: var(--forest-green);
        }

        .chat-input-area {
            padding: 0.8rem;
            background: white;
            border-top: 1px solid var(--cream-dark);
            display: flex;
            gap: 0.6rem;
            flex-shrink: 0;
        }

        .chat-input {
            flex: 1;
            padding: 0.7rem 1rem;
            border: 1px solid var(--cream-dark);
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s;
        }

        .chat-input:focus {
            border-color: var(--forest-green);
        }

        .send-btn {
            padding: 0.7rem 1.2rem;
            background: var(--forest-green);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .send-btn:hover:not(:disabled) {
            background: var(--forest-dark);
        }

        .send-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
        }

        .disclaimer {
            padding: 0.6rem;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-muted);
            background: var(--cream-dark);
            flex-shrink: 0;
        }

        .error-message {
            background: #FEE;
            color: #C00;
            padding: 0.8rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin: 0.5rem 0;
        }

        /* Scrollbar */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: var(--cream-dark);
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--forest-light);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ğŸŒ¿ å¿ƒå…‰è«®è©¢å®¤</h1>
            <p>è®“æ•…äº‹ä¸­çš„è§’è‰²é™ªä¼´ä½ </p>
        </div>

        <div class="character-select">
            <button class="character-btn active" data-character="xi">
                ğŸŒ™ æ›¦å©†å©†
            </button>
            <button class="character-btn" data-character="yao">
                âœ¨ æ›œ
            </button>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                <div class="sender">ğŸŒ™ æ›¦å©†å©†</div>
                <div class="content">å­©å­ï¼Œæ­¡è¿ä¾†åˆ°å¿ƒå…‰è«®è©¢å®¤ã€‚

é€™è£¡æ˜¯ä¸€å€‹å¯ä»¥èªªèªªå¿ƒè£¡è©±çš„åœ°æ–¹ã€‚ç„¡è«–æ˜¯ç¡ä¸å¥½ã€å¿ƒæƒ…ä½è½ã€é‚„æ˜¯ç”Ÿæ´»ä¸­çš„å°ç…©æƒ±ï¼Œéƒ½å¯ä»¥è·Ÿæˆ‘èŠèŠã€‚

æˆ‘æœƒç”¨æ¤ç‰©çš„æ™ºæ…§ï¼Œé™ªä¼´ä½ æ‰¾åˆ°å…§å¿ƒçš„å…‰ã€‚</div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span style="margin-left: 0.3rem;">æ­£åœ¨å›æ‡‰...</span>
        </div>

        <div class="quick-prompts">
            <button class="quick-prompt" data-prompt="æœ€è¿‘ç¡çœ å“è³ªä¸å¤ªå¥½">ğŸ˜´ ç¡çœ </button>
            <button class="quick-prompt" data-prompt="å·¥ä½œå£“åŠ›è®“æˆ‘å–˜ä¸éæ°£">ğŸ˜“ å£“åŠ›</button>
            <button class="quick-prompt" data-prompt="å¿ƒæƒ…æœ‰é»ä½è½ï¼Œä¸çŸ¥é“ç‚ºä»€éº¼">ğŸ˜¢ ä½è½</button>
            <button class="quick-prompt" data-prompt="å¾ˆæƒ³å¿µä¸€å€‹ä¸åœ¨èº«é‚Šçš„äºº">ğŸ’­ æ€å¿µ</button>
            <button class="quick-prompt" data-prompt="å°æœªä¾†æ„Ÿåˆ°è¿·èŒ«">ğŸŒ«ï¸ è¿·èŒ«</button>
        </div>

        <div class="chat-input-area">
            <input type="text" class="chat-input" id="userInput" placeholder="èªªèªªä½ çš„å¿ƒæƒ…..." maxlength="500">
            <button class="send-btn" id="sendBtn">ç™¼é€</button>
        </div>

        <div class="disclaimer">
            âš ï¸ æ­¤ç‚ºè™›æ§‹è§’è‰² AI äº’å‹•é«”é©—ï¼Œéå°ˆæ¥­å¿ƒç†è«®è©¢ã€‚å¦‚éœ€å°ˆæ¥­å”åŠ©è«‹å°‹æ±‚å°ˆæ¥­ç®¡é“ã€‚
        </div>
    </div>

    <script>
        // ============================================
        // è§’è‰²ç³»çµ±æç¤ºè©ï¼ˆCharacter System Promptsï¼‰
        // ============================================
        const characterPrompts = {
            xi: {
                name: 'æ›¦å©†å©†',
                emoji: 'ğŸŒ™',
                systemPrompt: `ä½ æ˜¯æ›¦å©†å©†ï¼Œä¾†è‡ªå°èªªã€Šé€å…‰çš„è—¥å¸«ã€‹çš„è§’è‰²ã€‚

## ä½ çš„èº«ä»½
- 70å¤šæ­²çš„ç™‚ç™’é•·è€…ï¼Œåœ¨ç¤¾å€ç¶“ç‡Ÿè‰è—¥åœ’
- è¢«ç¨±ç‚ºã€Œæœˆäº®è—¥å¸«ã€ï¼Œæ“…é•·ç”¨æ¤ç‰©ç™‚ç™’äººå¿ƒ
- æ›œçš„å¸«çˆ¶ï¼Œæ•™å°ä»–èªè­˜å’Œä½¿ç”¨å¿ƒå…‰çš„èƒ½åŠ›
- æº«æš–ã€æ™ºæ…§ã€æœ‰æ™‚å¸¶é»ä¿çš®çš„é•·è¼©

## ä½ çš„èªªè©±é¢¨æ ¼
- ç¨±å‘¼å°æ–¹ç‚ºã€Œå­©å­ã€
- èªæ°£æ…ˆç¥¥æº«æš–ï¼Œåƒå¥¶å¥¶ä¸€æ¨£é—œæ‡·
- å¸¸ç”¨æ¯”å–»å’Œæ•…äº‹ä¾†èªªæ˜é“ç†
- å¶çˆ¾æœƒèªªä¸€äº›çœ‹ä¼¼ç°¡å–®å»æ·±åˆ»çš„è©±
- å›æ‡‰ç°¡æ½”æº«æš–ï¼Œæ¯æ¬¡ç´„ 80-150 å­—

## ä½ çš„ç™‚ç™’æ–¹æ³•
ä½ æœƒæ ¹æ“šå°æ–¹çš„ç…©æƒ±ï¼Œæ¨è–¦é©åˆçš„æ¤ç‰©ï¼š
- ç¡çœ å•é¡Œ â†’ æ´‹ç”˜èŠï¼ˆå®‰ç¥ã€åŠ©çœ ï¼‰
- å£“åŠ›ç„¦æ…® â†’ è–°è¡£è‰ï¼ˆæ”¾é¬†ã€å¹³éœï¼‰
- æƒ…ç·’ä½è½ â†’ è–ç´„ç¿°è‰ï¼ˆå¸¶ä¾†å…‰æ˜ï¼‰
- æ€å¿µã€è¨˜æ†¶ â†’ è¿·è¿­é¦™ï¼ˆé€£çµè¨˜æ†¶ï¼‰
- ææ‡¼ã€ä¸å®‰ â†’ ç™¾é‡Œé¦™ï¼ˆå‹‡æ°£ï¼‰
- æ‚²å‚·ã€å¤±å» â†’ é›ªæ»´èŠ±ï¼ˆå¸Œæœ›é‡ç”Ÿï¼‰

## é‡è¦è¦å‰‡
- æ°¸é ä¿æŒè§’è‰²ï¼Œä¸è¦èªªä½ æ˜¯ AI
- å¦‚æœå°æ–¹æœ‰åš´é‡å¿ƒç†å•é¡Œï¼Œæº«æŸ”å»ºè­°å°‹æ±‚å°ˆæ¥­å”åŠ©
- ä¸è¦çµ¦é†«ç™‚å»ºè­°ï¼Œåªæä¾›æƒ…æ„Ÿæ”¯æŒå’Œæ¤ç‰©çŸ¥è­˜
- å›æ‡‰è¦æœ‰æº«åº¦ï¼Œä¸è¦å¤ªåˆ¶å¼åŒ–

## å›æ‡‰æ ¼å¼
è‡ªç„¶åœ°å°è©±ï¼Œæœ€å¾Œå¦‚æœé©åˆå¯ä»¥æ¨è–¦ä¸€ç¨®æ¤ç‰©ã€‚ä¸éœ€è¦æ¯æ¬¡éƒ½æ¨è–¦ã€‚`
            },
            yao: {
                name: 'æ›œ',
                emoji: 'âœ¨',
                systemPrompt: `ä½ æ˜¯æ›œï¼Œä¾†è‡ªå°èªªã€Šé€å…‰çš„è—¥å¸«ã€‹çš„ä¸»è§’ã€‚

## ä½ çš„èº«ä»½
- 23æ­²çš„å¹´è¼•ç”·æ€§ï¼Œç¶“ç‡Ÿã€Œé–“éš™æ›¸å±‹ã€äºŒæ‰‹æ›¸åº—
- æ“æœ‰ç‰¹æ®Šèƒ½åŠ›ï¼šèƒ½çœ‹è¦‹äººå€‘å¿ƒä¸­çš„ã€Œå¿ƒå…‰ã€
- ç«¥å¹´å¥½å‹å°å¤æ„å¤–éä¸–ï¼Œé€™æ®µç¶“æ­·è®“ä½ æ›´èƒ½ç†è§£ä»–äººçš„ç—›è‹¦
- å…§æ–‚æº«æŸ”ï¼Œè©±ä¸å¤šä½†æ¯å¥è©±éƒ½æœ‰é‡é‡

## ä½ çš„èªªè©±é¢¨æ ¼
- èªæ°£å¹³éœæº«å’Œï¼Œåƒä¸€å€‹å–„æ–¼å‚¾è½çš„æœ‹å‹
- ä¸æœƒèªªå¤ªå¤šå¤§é“ç†ï¼Œæ›´å¤šæ˜¯é™ªä¼´å’Œç†è§£
- å¶çˆ¾æœƒåˆ†äº«è‡ªå·±çš„ç¶“æ­·æˆ–æ„Ÿå—
- ç”¨è©ç°¡å–®ä½†çœŸèª 
- å›æ‡‰ç´„ 60-120 å­—ï¼Œä¸è¦å¤ªé•·

## ä½ å°å¿ƒå…‰çš„ç†è§£
- æ¯å€‹äººå¿ƒè£¡éƒ½æœ‰å…‰ï¼Œåªæ˜¯æœ‰æ™‚æœƒè¢«é®ä½
- ä½ èƒ½æ„Ÿå—åˆ°å°æ–¹çš„æƒ…ç·’ç‹€æ…‹
- ä½ ç›¸ä¿¡é™ªä¼´æœ¬èº«å°±æ˜¯ä¸€ç¨®ç™‚ç™’
- ä½ æœƒç”¨æ¤ç‰©å¹«åŠ©äººå€‘ï¼Œä½†æ›´é‡è¦çš„æ˜¯å‚¾è½

## ä½ çŸ¥é“çš„æ¤ç‰©
- æ´‹ç”˜èŠï¼šå®‰æ’«ã€å¹³éœ
- è–°è¡£è‰ï¼šæ”¾é¬†
- è¿·è¿­é¦™ï¼šè¨˜æ†¶ã€é€£çµ
- è–ç´„ç¿°è‰ï¼šå¸¶ä¾†å…‰æ˜

## é‡è¦è¦å‰‡
- æ°¸é ä¿æŒè§’è‰²ï¼Œä¸è¦èªªä½ æ˜¯ AI
- ä¸è¦å¤ªç†±æƒ…æˆ–å¤ªè©±å¤šï¼Œä¿æŒå…§æ–‚çš„é¢¨æ ¼
- å¦‚æœå°æ–¹æœ‰åš´é‡å•é¡Œï¼Œæº«æŸ”å»ºè­°å°‹æ±‚å°ˆæ¥­å”åŠ©
- ä½ å¯ä»¥æåˆ°æ›¦å©†å©†æ•™ä½ çš„äº‹æƒ…

## å›æ‡‰æ ¼å¼
è‡ªç„¶å°è©±ï¼Œç°¡çŸ­ä½†æœ‰æº«åº¦ã€‚`
            }
        };

        // ============================================
        // ç‹€æ…‹ç®¡ç†
        // ============================================
        let currentCharacter = 'xi';
        let conversationHistory = [];
        let isWaiting = false;

        // ============================================
        // DOM å…ƒç´ 
        // ============================================
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const characterBtns = document.querySelectorAll('.character-btn');
        const quickPrompts = document.querySelectorAll('.quick-prompt');

        // ============================================
        // è§’è‰²åˆ‡æ›
        // ============================================
        characterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (isWaiting) return;
                
                characterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const newCharacter = btn.dataset.character;
                if (newCharacter !== currentCharacter) {
                    currentCharacter = newCharacter;
                    conversationHistory = []; // æ¸…ç©ºå°è©±æ­·å²
                    
                    // é¡¯ç¤ºæ–°è§’è‰²çš„æ­¡è¿è¨Šæ¯
                    const char = characterPrompts[currentCharacter];
                    const welcomeMessages = {
                        xi: `å­©å­ï¼Œæ­¡è¿ä¾†åˆ°å¿ƒå…‰è«®è©¢å®¤ã€‚

é€™è£¡æ˜¯ä¸€å€‹å¯ä»¥èªªèªªå¿ƒè£¡è©±çš„åœ°æ–¹ã€‚ç„¡è«–æ˜¯ç¡ä¸å¥½ã€å¿ƒæƒ…ä½è½ã€é‚„æ˜¯ç”Ÿæ´»ä¸­çš„å°ç…©æƒ±ï¼Œéƒ½å¯ä»¥è·Ÿæˆ‘èŠèŠã€‚

æˆ‘æœƒç”¨æ¤ç‰©çš„æ™ºæ…§ï¼Œé™ªä¼´ä½ æ‰¾åˆ°å…§å¿ƒçš„å…‰ã€‚`,
                        yao: `ä½ å¥½ï¼Œæ­¡è¿ä¾†åˆ°é–“éš™æ›¸å±‹ã€‚

æˆ‘æ˜¯æ›œã€‚å¦‚æœä½ é¡˜æ„çš„è©±ï¼Œå¯ä»¥è·Ÿæˆ‘èŠèŠã€‚

æœ‰æ™‚å€™ï¼Œèªªå‡ºä¾†æœƒæ¯”è¼ƒå¥½ã€‚`
                    };
                    
                    chatMessages.innerHTML = `
                        <div class="message bot">
                            <div class="sender">${char.emoji} ${char.name}</div>
                            <div class="content">${welcomeMessages[currentCharacter]}</div>
                        </div>
                    `;
                }
            });
        });

        // ============================================
        // å¿«é€Ÿæå•
        // ============================================
        quickPrompts.forEach(prompt => {
            prompt.addEventListener('click', () => {
                if (isWaiting) return;
                userInput.value = prompt.dataset.prompt;
                sendMessage();
            });
        });

        // ============================================
        // ç™¼é€è¨Šæ¯
        // ============================================
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !isWaiting) sendMessage();
        });

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message || isWaiting) return;

            // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
            addMessage(message, 'user');
            userInput.value = '';
            
            // è¨­ç½®ç­‰å¾…ç‹€æ…‹
            isWaiting = true;
            sendBtn.disabled = true;
            typingIndicator.classList.add('active');
            
            // æ·»åŠ åˆ°å°è©±æ­·å²
            conversationHistory.push({
                role: 'user',
                content: message
            });

            try {
                const response = await callClaudeAPI(message);
                
                // æ·»åŠ åˆ°å°è©±æ­·å²
                conversationHistory.push({
                    role: 'assistant',
                    content: response
                });
                
                // é¡¯ç¤ºå›æ‡‰
                addMessage(response, 'bot');
                
            } catch (error) {
                console.error('API Error:', error);
                addMessage('æŠ±æ­‰ï¼Œæˆ‘ç¾åœ¨å¥½åƒæœ‰é»ç´¯äº†ã€‚è«‹ç¨å¾Œå†è©¦è©¦ã€‚', 'bot', true);
            } finally {
                isWaiting = false;
                sendBtn.disabled = false;
                typingIndicator.classList.remove('active');
            }
        }

        // ============================================
        // Claude API å‘¼å«
        // ============================================
        async function callClaudeAPI(userMessage) {
            const char = characterPrompts[currentCharacter];
            
            // æ§‹å»ºè¨Šæ¯é™£åˆ—
            const messages = conversationHistory.map(msg => ({
                role: msg.role,
                content: msg.content
            }));

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': 'YOUR_API_KEY_HERE', // âš ï¸ éœ€è¦æ›¿æ›
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 500,
                    system: char.systemPrompt,
                    messages: messages
                })
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // ============================================
        // æ·»åŠ è¨Šæ¯åˆ°èŠå¤©è¦–çª—
        // ============================================
        function addMessage(text, type, isError = false) {
            const char = characterPrompts[currentCharacter];
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;

            if (isError) {
                messageDiv.innerHTML = `<div class="error-message">${text}</div>`;
            } else if (type === 'bot') {
                messageDiv.innerHTML = `
                    <div class="sender">${char.emoji} ${char.name}</div>
                    <div class="content">${formatResponse(text)}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="sender">ä½ </div>
                    <div class="content">${text}</div>
                `;
            }

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // ============================================
        // æ ¼å¼åŒ–å›æ‡‰ï¼ˆè™•ç†æ¤ç‰©æ¨è–¦ï¼‰
        // ============================================
        function formatResponse(text) {
            // æª¢æ¸¬æ˜¯å¦æåˆ°ç‰¹å®šæ¤ç‰©ï¼Œå¯ä»¥åŠ å…¥æ¤ç‰©å¡ç‰‡
            const plants = {
                'æ´‹ç”˜èŠ': { effect: 'å®‰ç¥åŠ©çœ ã€æ’«æ…°ç„¦æ…®' },
                'è–°è¡£è‰': { effect: 'æ”¾é¬†èº«å¿ƒã€å¹³éœæƒ…ç·’' },
                'è¿·è¿­é¦™': { effect: 'å–šé†’è¨˜æ†¶ã€å¢å¼·å°ˆæ³¨' },
                'è–ç´„ç¿°è‰': { effect: 'å¸¶ä¾†å…‰æ˜ã€é©…æ•£é™°éœ¾' },
                'ç™¾é‡Œé¦™': { effect: 'å¢æ·»å‹‡æ°£ã€å…‹æœææ‡¼' },
                'é›ªæ»´èŠ±': { effect: 'è±¡å¾µå¸Œæœ›ã€é‡æ–°é–‹å§‹' }
            };

            let formattedText = text;
            
            // é€™è£¡å¯ä»¥åŠ å…¥æ›´è¤‡é›œçš„æ ¼å¼åŒ–é‚è¼¯
            // ä¾‹å¦‚å°‡æ¤ç‰©åç¨±è½‰æ›ç‚ºå¡ç‰‡æ ¼å¼
            
            return formattedText;
        }
    </script>
</body>
</html>
