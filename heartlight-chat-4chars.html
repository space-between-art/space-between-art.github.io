<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒå…‰è«®è©¢å®¤ | Space Between Art</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&family=Noto+Sans+TC:wght@300;400;500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --forest-green: #2C5F2D;
            --forest-dark: #1A3A1B;
            --warm-gold: #D4A84B;
            --gold-light: #E8C97A;
            --steel-blue: #2C3E50;
            --steel-dark: #1A252F;
            --copper: #B87333;
            --copper-light: #D4956A;
            --cream: #FDF8F3;
            --cream-dark: #F5EDE4;
            --text-dark: #2A2A2A;
            --text-muted: #6B6B6B;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            transition: background 0.5s ease;
        }
        
        body.theme-pharmacist {
            background: linear-gradient(135deg, var(--forest-dark) 0%, var(--forest-green) 100%);
        }
        
        body.theme-renovator {
            background: linear-gradient(135deg, var(--steel-dark) 0%, var(--steel-blue) 100%);
        }

        .chat-container {
            width: 100%;
            max-width: 520px;
            background: var(--cream);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 85vh;
        }

        .chat-header {
            padding: 1.2rem;
            text-align: center;
            transition: background 0.5s ease;
        }
        
        .theme-pharmacist .chat-header { background: var(--forest-green); }
        .theme-renovator .chat-header { background: var(--steel-blue); }

        .chat-header h1 {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.4rem;
            margin-bottom: 0.2rem;
            transition: color 0.5s ease;
        }
        
        .theme-pharmacist .chat-header h1 { color: var(--gold-light); }
        .theme-renovator .chat-header h1 { color: var(--copper-light); }

        .chat-header p {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.9);
        }

        .work-tabs {
            display: flex;
            background: var(--cream-dark);
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .work-tab {
            flex: 1;
            padding: 0.8rem 0.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-muted);
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .work-tab.active {
            color: var(--text-dark);
            font-weight: 500;
        }
        
        .work-tab.active.pharmacist { border-bottom-color: var(--forest-green); }
        .work-tab.active.renovator { border-bottom-color: var(--steel-blue); }

        .character-select {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem;
            background: white;
            flex-wrap: wrap;
        }

        .character-btn {
            padding: 0.4rem 0.8rem;
            border: 2px solid var(--cream-dark);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .character-btn.active.pharmacist {
            background: var(--forest-green);
            border-color: var(--forest-green);
            color: white;
        }
        
        .character-btn.active.renovator {
            background: var(--steel-blue);
            border-color: var(--steel-blue);
            color: white;
        }

        .character-btn:hover:not(.active) { background: var(--cream); }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            min-height: 280px;
            max-height: 350px;
        }

        .message {
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot { align-self: flex-start; }
        .message.user { align-self: flex-end; }

        .message .sender {
            font-size: 0.75rem;
            margin-bottom: 0.3rem;
            opacity: 0.7;
        }

        .message .content {
            padding: 0.8rem 1rem;
            border-radius: 16px;
            line-height: 1.6;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        .message.bot .content {
            background: var(--cream-dark);
            border-bottom-left-radius: 4px;
        }

        .message.user .content {
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .theme-pharmacist .message.user .content { background: var(--forest-green); }
        .theme-renovator .message.user .content { background: var(--steel-blue); }

        .typing-indicator {
            display: none;
            align-items: center;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .typing-indicator.show { display: flex; }

        .typing-dot {
            width: 5px;
            height: 5px;
            background: var(--text-muted);
            border-radius: 50%;
            margin-right: 3px;
            animation: typingBounce 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        .quick-prompts {
            display: flex;
            gap: 0.4rem;
            padding: 0.6rem;
            overflow-x: auto;
            background: white;
            border-top: 1px solid var(--cream-dark);
        }

        .quick-prompt {
            flex-shrink: 0;
            padding: 0.35rem 0.7rem;
            background: var(--cream);
            border: 1px solid var(--cream-dark);
            border-radius: 16px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-prompt:hover { background: var(--cream-dark); }

        .chat-input-area {
            display: flex;
            padding: 0.8rem;
            gap: 0.5rem;
            background: white;
            border-top: 1px solid var(--cream-dark);
        }

        .chat-input {
            flex: 1;
            padding: 0.7rem 1rem;
            border: 2px solid var(--cream-dark);
            border-radius: 24px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .theme-pharmacist .chat-input:focus { border-color: var(--forest-green); }
        .theme-renovator .chat-input:focus { border-color: var(--steel-blue); }

        .send-btn {
            padding: 0.7rem 1.2rem;
            border: none;
            border-radius: 24px;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .theme-pharmacist .send-btn { background: var(--forest-green); }
        .theme-renovator .send-btn { background: var(--steel-blue); }

        .send-btn:hover { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .disclaimer {
            padding: 0.5rem;
            background: var(--cream-dark);
            font-size: 0.65rem;
            color: var(--text-muted);
            text-align: center;
        }

        .back-link {
            display: block;
            text-align: center;
            padding: 0.8rem;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            font-size: 0.85rem;
        }
        
        .back-link:hover { color: white; }

        .chat-messages::-webkit-scrollbar { width: 5px; }
        .chat-messages::-webkit-scrollbar-track { background: var(--cream-dark); }
        .chat-messages::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 3px; }

        .api-notice {
            background: rgba(255,200,50,0.2);
            border: 1px solid rgba(255,200,50,0.5);
            border-radius: 8px;
            padding: 0.8rem;
            margin: 0.5rem;
            font-size: 0.75rem;
            text-align: center;
        }

        .api-notice a {
            color: var(--forest-green);
            font-weight: 500;
        }
    </style>
</head>
<body class="theme-pharmacist">
    <div class="chat-container">
        <div class="chat-header">
            <h1 id="headerTitle">ğŸŒ¿ å¿ƒå…‰è«®è©¢å®¤</h1>
            <p id="headerSubtitle">è®“æ•…äº‹ä¸­çš„è§’è‰²é™ªä¼´ä½ </p>
        </div>

        <div class="work-tabs">
            <button class="work-tab active pharmacist" data-work="pharmacist">ğŸŒ¿ é€å…‰çš„è—¥å¸«</button>
            <button class="work-tab renovator" data-work="renovator">ğŸ”§ é•ç« éˆé­‚æ”¹å»º</button>
        </div>

        <div class="character-select" id="characterSelect"></div>

        <div class="api-notice" id="apiNotice">
            âš™ï¸ æ­¤ç‚ºå±•ç¤ºç‰ˆæœ¬ï¼Œä½¿ç”¨é è¨­å›æ‡‰ã€‚<br>
            éƒ¨ç½² Claude API å¾Œå¯å•Ÿç”¨çœŸå¯¦ AI å°è©±ã€‚<a href="AIå°ç·¨å®Œæ•´éƒ¨ç½²æ•™å­¸.md">æŸ¥çœ‹æ•™å­¸</a>
        </div>

        <div class="chat-messages" id="chatMessages"></div>

        <div class="typing-indicator" id="typingIndicator">
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span class="typing-dot"></span>
            <span style="margin-left: 0.3rem;">æ­£åœ¨å›æ‡‰...</span>
        </div>

        <div class="quick-prompts" id="quickPrompts"></div>

        <div class="chat-input-area">
            <input type="text" class="chat-input" id="userInput" placeholder="èªªèªªä½ çš„å¿ƒæƒ…..." maxlength="500">
            <button class="send-btn" id="sendBtn">ç™¼é€</button>
        </div>

        <div class="disclaimer">
            âš ï¸ æ­¤ç‚ºè™›æ§‹è§’è‰² AI äº’å‹•é«”é©—ï¼Œéå°ˆæ¥­å¿ƒç†è«®è©¢ã€‚å¦‚éœ€å°ˆæ¥­å”åŠ©è«‹å°‹æ±‚å°ˆæ¥­ç®¡é“ã€‚
        </div>
    </div>
    
    <a href="index.html" class="back-link">â† è¿”å›é¦–é </a>

    <script>
        // ============================================
        // API è¨­å®šï¼ˆéƒ¨ç½²å¾Œæ›¿æ›ï¼‰
        // ============================================
        const API_ENDPOINT = ''; // æ›¿æ›æˆä½ çš„ Cloudflare Worker URL
        const USE_MOCK = !API_ENDPOINT; // æ²’æœ‰ API æ™‚ä½¿ç”¨æ¨¡æ“¬å›æ‡‰
        
        // ============================================
        // è§’è‰²èˆ‡ä½œå“è¨­å®š
        // ============================================
        const WORKS = {
            pharmacist: {
                name: 'é€å…‰çš„è—¥å¸«',
                theme: 'theme-pharmacist',
                headerTitle: 'ğŸŒ¿ å¿ƒå…‰è«®è©¢å®¤',
                headerSubtitle: 'è®“æ¤ç‰©çš„æ™ºæ…§é™ªä¼´ä½ ',
                characters: {
                    xi: {
                        name: 'æ›¦å©†å©†',
                        emoji: 'ğŸŒ™',
                        title: 'æœˆäº®è—¥å¸«',
                        welcome: `å­©å­ï¼Œæ­¡è¿ä¾†åˆ°å¿ƒå…‰è«®è©¢å®¤ã€‚

é€™è£¡æ˜¯ä¸€å€‹å¯ä»¥èªªèªªå¿ƒè£¡è©±çš„åœ°æ–¹ã€‚ç„¡è«–æ˜¯ç¡ä¸å¥½ã€å¿ƒæƒ…ä½è½ã€é‚„æ˜¯ç”Ÿæ´»ä¸­çš„å°ç…©æƒ±ï¼Œéƒ½å¯ä»¥è·Ÿæˆ‘èŠèŠã€‚

æˆ‘æœƒç”¨æ¤ç‰©çš„æ™ºæ…§ï¼Œé™ªä¼´ä½ æ‰¾åˆ°å…§å¿ƒçš„å…‰ã€‚`,
                        mockResponses: {
                            ç¡çœ : 'å­©å­ï¼Œç¡ä¸å¥½çš„å¤œæ™šç¢ºå¯¦é›£ç†¬ã€‚æˆ‘æƒ³æ¨è–¦ä½ æ´‹ç”˜èŠâ€”â€”å®ƒæœ‰å®‰æ’«å¿ƒç¥çš„åŠ›é‡ã€‚ç¡å‰æ³¡ä¸€æ¯æ´‹ç”˜èŠèŒ¶ï¼Œè®“é‚£æº«æš–çš„é¦™æ°£åŒ…è£¹ä½ ã€‚è¨˜å¾—ï¼Œä¸è¦å¤ªè‹›è²¬è‡ªå·±ï¼Œæœ‰æ™‚å€™èº«é«”åªæ˜¯éœ€è¦å¤šä¸€é»æ™‚é–“æ”¾é¬†ã€‚',
                            å£“åŠ›: 'æˆ‘çœ‹å¾—å‡ºä½ ç´¯äº†ã€‚å£“åŠ›å°±åƒèƒŒä¸Šçš„çŸ³é ­ï¼Œä¹…äº†æœƒè®“äººå–˜ä¸éæ°£ã€‚è–°è¡£è‰èƒ½å¹«åŠ©æ”¾é¬†ï¼Œä½†æ›´é‡è¦çš„æ˜¯â€”â€”ä½ é¡˜æ„çµ¦è‡ªå·±ä¼‘æ¯çš„å…è¨±å—ï¼Ÿæœ‰æ™‚å€™ï¼Œæš«åœä¸æ˜¯æ”¾æ£„ï¼Œæ˜¯ç‚ºäº†èµ°æ›´é çš„è·¯ã€‚',
                            ä½è½: 'å­©å­ï¼Œå¿ƒæƒ…ä½è½çš„æ™‚å€™ï¼Œå°±åƒå¿ƒè£¡çš„å…‰è¢«é›²é®ä½äº†ã€‚ä½†ä½ è¦è¨˜å¾—ï¼Œå…‰ä¸€ç›´éƒ½åœ¨ã€‚è–ç´„ç¿°è‰è¢«ç¨±ç‚ºã€Œè¶•èµ°é™°éœ¾çš„é™½å…‰ã€ï¼Œå®ƒæˆ–è¨±èƒ½å¹«åŠ©ä½ ã€‚ä¸éæœ€é‡è¦çš„æ˜¯ï¼Œå…è¨±è‡ªå·±ä¸é–‹å¿ƒä¹Ÿæ²’é—œä¿‚ã€‚',
                            æ€å¿µ: 'æ€å¿µæ˜¯ä¸€ç¨®å¾ˆæº«æŸ”çš„ç—›ã€‚è¿·è¿­é¦™åœ¨å¤æ™‚å€™ä»£è¡¨ã€Œè¨˜æ†¶ã€ï¼Œäººå€‘ç›¸ä¿¡å®ƒèƒ½é€£çµæˆ‘å€‘èˆ‡æ‰€æ„›ä¹‹äººã€‚æƒ³å¿µä¸€å€‹äººï¼Œèªªæ˜ä½ å€‘ä¹‹é–“æœ‰éç¾å¥½çš„é€£çµã€‚é€™ä»½æ„›ä¸æœƒå› ç‚ºè·é›¢è€Œæ¶ˆå¤±ã€‚',
                            è¿·èŒ«: 'å°æœªä¾†è¿·èŒ«ï¼Œå…¶å¯¦æ˜¯å¾ˆæ­£å¸¸çš„ã€‚æ²’æœ‰äººèƒ½çœ‹æ¸…æ‰€æœ‰çš„è·¯ã€‚ä½†æˆ‘ç›¸ä¿¡ï¼Œåªè¦ä½ ç¹¼çºŒèµ°ï¼Œè·¯å°±æœƒåœ¨è…³ä¸‹å±•é–‹ã€‚ç™¾é‡Œé¦™ä»£è¡¨å‹‡æ°£ï¼Œå®ƒæé†’æˆ‘å€‘ï¼šä¸éœ€è¦çœ‹æ¸…å…¨ç¨‹ï¼Œåªéœ€è¦è¸å‡ºä¸‹ä¸€æ­¥å°±å¥½ã€‚',
                            default: 'å­©å­ï¼Œè¬è¬ä½ é¡˜æ„èªªå‡ºä¾†ã€‚æ¯å€‹äººå¿ƒè£¡éƒ½æœ‰å…‰ï¼Œåªæ˜¯æœ‰æ™‚å€™æœƒè¢«é®ä½ã€‚ä½ é¡˜æ„å¤šèªªä¸€é»å—ï¼Ÿæˆ‘åœ¨è½ã€‚'
                        }
                    },
                    yao: {
                        name: 'æ›œ',
                        emoji: 'âœ¨',
                        title: 'é€å…‰è—¥å¸«',
                        welcome: `ä½ å¥½ï¼Œæ­¡è¿ä¾†åˆ°é–“éš™æ›¸å±‹ã€‚

æˆ‘æ˜¯æ›œã€‚å¦‚æœä½ é¡˜æ„çš„è©±ï¼Œå¯ä»¥è·Ÿæˆ‘èŠèŠã€‚

æœ‰æ™‚å€™ï¼Œèªªå‡ºä¾†æœƒæ¯”è¼ƒå¥½ã€‚`,
                        mockResponses: {
                            ç¡çœ : 'ç¡ä¸å¥½çš„æ„Ÿè¦ºï¼Œæˆ‘æ‡‚ã€‚å¤œè£¡ç‰¹åˆ¥å®‰éœçš„æ™‚å€™ï¼Œåè€Œæ›´å®¹æ˜“èƒ¡æ€äº‚æƒ³ã€‚æ›¦å©†å©†å¸¸èªªï¼Œæ´‹ç”˜èŠèƒ½å®‰æ’«ä¸å®‰çš„å¿ƒã€‚...ä½ æœ€è¿‘æ˜¯æœ‰ä»€éº¼äº‹æƒ…åœ¨ç…©æƒ±å—ï¼Ÿ',
                            å£“åŠ›: 'æˆ‘æ„Ÿè¦ºåˆ°ä½ çš„å…‰æœ‰é»ç–²æ†Šã€‚å£“åŠ›å¤ªå¤§çš„æ™‚å€™ï¼Œé€£å‘¼å¸éƒ½æœƒå¿˜è¨˜ã€‚å…ˆæ·±å‘¼å¸ä¸€ä¸‹å§ã€‚...æˆ‘åœ¨é€™è£¡ï¼Œä¸æ€¥ã€‚',
                            ä½è½: 'å—¯...ä½è½çš„æ„Ÿè¦ºï¼Œå°±åƒå¿ƒå…‰è¢«ä»€éº¼æ±è¥¿è“‹ä½äº†ã€‚ä½†å®ƒé‚„åœ¨ï¼Œåªæ˜¯æš«æ™‚çœ‹ä¸æ¸…æ¥šã€‚ä½ ä¸éœ€è¦å‹‰å¼·è‡ªå·±æŒ¯ä½œï¼Œå°±è®“å®ƒæ…¢æ…¢ä¾†å§ã€‚',
                            æ€å¿µ: 'æƒ³å¿µä¸€å€‹äºº...æˆ‘ä¹Ÿæœ‰éé€™ç¨®æ„Ÿè¦ºã€‚å°å¤é›¢é–‹ä¹‹å¾Œï¼Œæˆ‘èŠ±äº†å¾ˆé•·æ™‚é–“æ‰å­¸æœƒèˆ‡æ€å¿µå…±è™•ã€‚å®ƒä¸æœƒæ¶ˆå¤±ï¼Œä½†æœƒæ…¢æ…¢è®Šå¾—ä¸é‚£éº¼å°–éŠ³ã€‚',
                            è¿·èŒ«: 'è¿·èŒ«å•Š...èªªå¯¦è©±ï¼Œæˆ‘ä¹Ÿå¸¸å¸¸ä¸ç¢ºå®šè‡ªå·±åœ¨åšä»€éº¼ã€‚ä½†æ›¦å©†å©†èªªï¼Œã€Œå…‰æœƒå¸å¼•å…‰ã€ã€‚ä¹Ÿè¨±ä¸éœ€è¦ç¾åœ¨å°±æ‰¾åˆ°ç­”æ¡ˆï¼Œåªè¦ç¹¼çºŒç™¼å…‰å°±å¥½ã€‚',
                            default: '...è¬è¬ä½ é¡˜æ„è·Ÿæˆ‘èªªã€‚æˆ‘ä¸å¤ªæœƒèªªä»€éº¼å¤§é“ç†ï¼Œä½†æˆ‘å¯ä»¥åœ¨é€™è£¡é™ªè‘—ä½ ã€‚'
                        }
                    }
                },
                quickPrompts: [
                    { emoji: 'ğŸ˜´', text: 'ç¡çœ ', prompt: 'æœ€è¿‘ç¡çœ å“è³ªä¸å¤ªå¥½', key: 'ç¡çœ ' },
                    { emoji: 'ğŸ˜“', text: 'å£“åŠ›', prompt: 'å·¥ä½œå£“åŠ›è®“æˆ‘å–˜ä¸éæ°£', key: 'å£“åŠ›' },
                    { emoji: 'ğŸ˜¢', text: 'ä½è½', prompt: 'å¿ƒæƒ…æœ‰é»ä½è½', key: 'ä½è½' },
                    { emoji: 'ğŸ’­', text: 'æ€å¿µ', prompt: 'å¾ˆæƒ³å¿µä¸€å€‹äºº', key: 'æ€å¿µ' },
                    { emoji: 'ğŸŒ«ï¸', text: 'è¿·èŒ«', prompt: 'å°æœªä¾†æ„Ÿåˆ°è¿·èŒ«', key: 'è¿·èŒ«' }
                ]
            },
            renovator: {
                name: 'é•ç« éˆé­‚æ”¹å»ºäº‹å‹™æ‰€',
                theme: 'theme-renovator',
                headerTitle: 'ğŸ”§ éˆé­‚æ”¹å»ºè«®è©¢',
                headerSubtitle: 'è®“æˆ‘å€‘çœ‹çœ‹ä½ å¿ƒä¸­çš„æˆ¿å­',
                characters: {
                    luyao: {
                        name: 'è·¯é™',
                        emoji: 'ğŸ”§',
                        title: 'æ”¹å»ºå¸«',
                        welcome: `ä½ å¥½ï¼Œé€™è£¡æ˜¯é•ç« éˆé­‚æ”¹å»ºäº‹å‹™æ‰€ã€‚

æˆ‘æ˜¯è·¯é™ï¼Œå¿ƒéˆå»ºç¯‰æ”¹å»ºå¸«ã€‚æˆ‘èƒ½çœ‹è¦‹æ¯å€‹äººå¿ƒä¸­çš„ã€Œæˆ¿å­ã€ã€‚

å¦‚æœä½ é¡˜æ„ï¼Œå¯ä»¥è®“æˆ‘çœ‹çœ‹ä½ çš„ã€‚`,
                        mockResponses: {
                            é‚Šç•Œ: 'è®“æˆ‘çœ‹çœ‹...ä½ çš„æˆ¿å­ä¼¼ä¹æ²’æœ‰é–€ï¼Œæˆ–è€…é–€å¤ªå®¹æ˜“è¢«æ‰“é–‹ã€‚é€™ç¨®ã€Œç»ç’ƒå±‹ã€çµæ§‹å¾ˆå¸¸è¦‹ï¼Œé€šå¸¸æ˜¯å› ç‚ºç¿’æ…£æŠŠåˆ¥äººçš„éœ€æ±‚æ”¾åœ¨è‡ªå·±å‰é¢ã€‚æˆ‘å€‘å¯ä»¥ä¸€èµ·è©¦è‘—ç Œå¹¾å¡Šé‚Šç•Œç£šã€‚',
                            å°é–‰: 'æœ‰è¶£ã€‚ä½ çš„å»ºç¯‰å¤–ç‰†å¾ˆåšå¯¦ï¼Œåƒå€‹ç¢‰å ¡ã€‚é€™ä¸æ˜¯å£äº‹â€”â€”å®ƒæ›¾ç¶“ä¿è­·éä½ ã€‚ä½†ç¾åœ¨ï¼Œä¹Ÿè¨±æˆ‘å€‘å¯ä»¥è€ƒæ…®é–‹ä¸€æ‰‡å°çª—ï¼Ÿä¸ç”¨ä¸€æ¬¡æ‹†æ‰æ•´é¢ç‰†ã€‚',
                            éº»æœ¨: 'å—¯...ä½ çš„æˆ¿å­çœ‹èµ·ä¾†æœ‰é»ç°æš—ï¼Œåƒæ˜¯å¾ˆä¹…æ²’æœ‰äººä½çš„æ¨£å­ã€‚æœ‰æ™‚å€™éº»æœ¨æ˜¯ä¸€ç¨®ä¿è­·æ©Ÿåˆ¶ï¼Œè®“æˆ‘å€‘ä¸ç”¨ä¸€ç›´æ„Ÿå—ç—›è‹¦ã€‚ä½†å¦‚æœæº–å‚™å¥½äº†ï¼Œæˆ‘å€‘å¯ä»¥è©¦è‘—æ‰“é–‹çª—æˆ¶é€é€æ°£ã€‚',
                            é‡è¤‡: 'æˆ‘çœ‹åˆ°äº†...ä½ çš„å»ºç¯‰è£¡æœ‰ä¸€åº§ç„¡é™æ¨“æ¢¯ï¼Œä¸æ–·å¾ªç’°ã€‚é€™é€šå¸¸ä»£è¡¨æŸå€‹é‚„æ²’è™•ç†å®Œçš„å‰µå‚·åœ¨é‡æ’­ã€‚ä¸æ˜¯ä½ çš„éŒ¯ï¼Œæœ‰æ™‚å€™æˆ‘å€‘éœ€è¦å°ˆæ¥­çš„å¹«åŠ©æ‰èƒ½èµ°å‡ºä¾†ã€‚',
                            è¿·å¤±: 'ä½ çš„å»ºç¯‰å¾ˆç‰¹åˆ¥â€”â€”å¤–è§€ç²¾ç·»ï¼Œä½†å…§éƒ¨...æœ‰é»ç©ºã€‚é€™ç¨®ã€Œæ¨£å“å±‹ã€çµæ§‹ï¼Œé€šå¸¸æ˜¯å› ç‚ºä¸€ç›´åœ¨ç¬¦åˆåˆ¥äººçš„æœŸå¾…ã€‚ä¹Ÿè¨±æˆ‘å€‘å¯ä»¥ä¸€èµ·æ‰¾æ‰¾ï¼ŒçœŸæ­£å±¬æ–¼ä½ çš„è¨­è¨ˆæ˜¯ä»€éº¼ã€‚',
                            default: 'è®“æˆ‘çœ‹çœ‹ä½ å¿ƒä¸­çš„æˆ¿å­...æ¯ä¸€åº§é•ç« å»ºç¯‰ï¼Œéƒ½æ˜¯ä¸€é“æ²’æœ‰è¢«è½è¦‹çš„æ±‚æ•‘ä¿¡è™Ÿã€‚ä½ é¡˜æ„å¤šèªªä¸€é»å—ï¼Ÿ'
                        }
                    },
                    guman: {
                        name: 'é¡§æ›¼',
                        emoji: 'ğŸ’œ',
                        title: 'å¿ƒç†å¸«',
                        welcome: `å—¨ï¼Œæ­¡è¿ä¾†åˆ°é€™è£¡ã€‚

æˆ‘æ˜¯é¡§æ›¼ï¼Œè·¯é™çš„å¤¥ä¼´ï¼Œä¹Ÿæ˜¯ä¸€åå¿ƒç†è«®å•†å¸«ã€‚

æœ‰ä»€éº¼æƒ³èŠçš„å—ï¼Ÿæˆ‘åœ¨è½ã€‚`,
                        mockResponses: {
                            é‚Šç•Œ: 'è¬è¬ä½ é¡˜æ„èªªå‡ºä¾†ã€‚å¾ˆé›£æ‹’çµ•åˆ¥äººï¼Œè½èµ·ä¾†è®“ä½ å¾ˆç´¯å§ï¼Ÿæˆ‘å¾ˆå¥½å¥‡ï¼Œç•¶ä½ è©¦è‘—æ‹’çµ•çš„æ™‚å€™ï¼Œæœƒæœ‰ä»€éº¼æ„Ÿè¦ºï¼Ÿæ˜¯å®³æ€•è®“å°æ–¹å¤±æœ›ï¼Œé‚„æ˜¯æ“”å¿ƒé—œä¿‚æœƒæ”¹è®Šå‘¢ï¼Ÿ',
                            å°é–‰: 'ä¸æ•¢æ•é–‹å¿ƒæ‰‰...é€™å€‹æ„Ÿå—å¾ˆå¤šäººéƒ½æœ‰ã€‚æœ‰æ™‚å€™ä¿æŒè·é›¢æ˜¯ä¸€ç¨®ä¿è­·è‡ªå·±çš„æ–¹å¼ã€‚ä½ é‚„è¨˜å¾—æ˜¯å¾ä»€éº¼æ™‚å€™é–‹å§‹ï¼Œè®Šå¾—æ¯”è¼ƒé›£ä¿¡ä»»äººå—ï¼Ÿ',
                            éº»æœ¨: 'æä¸èµ·å‹çš„æ„Ÿè¦ºï¼Œå¾ˆåƒæ˜¯å¿ƒç†åœ¨å‘Šè¨´æˆ‘å€‘éœ€è¦ä¼‘æ¯ã€‚é€™ç¨®ç‹€æ…‹æŒçºŒå¤šä¹…äº†å‘¢ï¼Ÿå¦‚æœå·²ç¶“æœ‰ä¸€æ®µæ™‚é–“ï¼Œä¹Ÿè¨±å¯ä»¥è€ƒæ…®æ‰¾å°ˆæ¥­çš„è«®å•†å¸«èŠèŠã€‚',
                            é‡è¤‡: 'é‡è¤‡åŒæ¨£çš„æ¨¡å¼ç¢ºå¯¦å¾ˆè®“äººæŒ«æŠ˜ã€‚ä½†ä½ çŸ¥é“å—ï¼Ÿèƒ½å¤ å¯Ÿè¦ºåˆ°é€™ä¸€é»ï¼Œå…¶å¯¦å·²ç¶“æ˜¯å¾ˆå¤§çš„é€²æ­¥äº†ã€‚æœ‰æ²’æœ‰æƒ³éï¼Œé€™å€‹æ¨¡å¼æ˜¯åœ¨ä»€éº¼æƒ…å¢ƒä¸‹ç‰¹åˆ¥å®¹æ˜“å‡ºç¾ï¼Ÿ',
                            è¿·å¤±: 'ä¸çŸ¥é“çœŸæ­£çš„è‡ªå·±æ˜¯ä»€éº¼æ¨£å­...é€™æ˜¯ä¸€å€‹å¾ˆæ·±åˆ»çš„å•é¡Œã€‚æœ‰æ™‚å€™æˆ‘å€‘å¤ªç¿’æ…£æ»¿è¶³åˆ¥äººçš„æœŸå¾…ï¼Œåè€Œå¿˜äº†å•è‡ªå·±çœŸæ­£æƒ³è¦ä»€éº¼ã€‚ä½ ç¾åœ¨æœ‰ä»€éº¼æ˜¯ã€Œæƒ³è¦ã€è€Œä¸æ˜¯ã€Œæ‡‰è©²ã€åšçš„äº‹å—ï¼Ÿ',
                            default: 'è¬è¬ä½ é¡˜æ„åˆ†äº«ã€‚ä½ èªªçš„é€™äº›è½èµ·ä¾†ä¸å®¹æ˜“ï¼Œæˆ‘å¾ˆæ„Ÿè¬ä½ çš„ä¿¡ä»»ã€‚ä½ é¡˜æ„å¤šèªªä¸€é»å—ï¼Ÿ'
                        }
                    }
                },
                quickPrompts: [
                    { emoji: 'ğŸ ', text: 'é‚Šç•Œ', prompt: 'æˆ‘ç¸½æ˜¯å¾ˆé›£æ‹’çµ•åˆ¥äºº', key: 'é‚Šç•Œ' },
                    { emoji: 'ğŸ”’', text: 'å°é–‰', prompt: 'æˆ‘ä¸å¤ªæ•¢å°äººæ•é–‹å¿ƒæ‰‰', key: 'å°é–‰' },
                    { emoji: 'ğŸ˜¶', text: 'éº»æœ¨', prompt: 'æœ€è¿‘å°ä»€éº¼äº‹éƒ½æä¸èµ·å‹', key: 'éº»æœ¨' },
                    { emoji: 'ğŸ”„', text: 'é‡è¤‡', prompt: 'æˆ‘å¥½åƒä¸€ç›´é‡è¤‡åŒæ¨£çš„éŒ¯èª¤', key: 'é‡è¤‡' },
                    { emoji: 'â“', text: 'è¿·å¤±', prompt: 'æˆ‘ä¸çŸ¥é“çœŸæ­£çš„è‡ªå·±æ˜¯ä»€éº¼æ¨£å­', key: 'è¿·å¤±' }
                ]
            }
        };

        // ç‹€æ…‹
        let currentWork = 'pharmacist';
        let currentCharacter = 'xi';
        let conversationHistory = [];
        let isWaiting = false;

        // DOM
        const body = document.body;
        const headerTitle = document.getElementById('headerTitle');
        const headerSubtitle = document.getElementById('headerSubtitle');
        const characterSelect = document.getElementById('characterSelect');
        const chatMessages = document.getElementById('chatMessages');
        const quickPromptsContainer = document.getElementById('quickPrompts');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const workTabs = document.querySelectorAll('.work-tab');
        const apiNotice = document.getElementById('apiNotice');

        // åˆå§‹åŒ–
        function init() {
            if (!USE_MOCK) apiNotice.style.display = 'none';
            renderCharacterButtons();
            renderQuickPrompts();
            showWelcomeMessage();
            
            workTabs.forEach(tab => tab.addEventListener('click', () => switchWork(tab.dataset.work)));
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
            });
        }

        function switchWork(work) {
            if (work === currentWork || isWaiting) return;
            currentWork = work;
            const workConfig = WORKS[work];
            
            body.className = workConfig.theme;
            headerTitle.textContent = workConfig.headerTitle;
            headerSubtitle.textContent = workConfig.headerSubtitle;
            
            workTabs.forEach(tab => {
                tab.classList.remove('active', 'pharmacist', 'renovator');
                if (tab.dataset.work === work) {
                    tab.classList.add('active', work);
                }
            });
            
            currentCharacter = Object.keys(workConfig.characters)[0];
            conversationHistory = [];
            renderCharacterButtons();
            renderQuickPrompts();
            showWelcomeMessage();
        }

        function switchCharacter(character) {
            if (character === currentCharacter || isWaiting) return;
            currentCharacter = character;
            conversationHistory = [];
            
            document.querySelectorAll('.character-btn').forEach(btn => {
                btn.classList.remove('active', 'pharmacist', 'renovator');
                if (btn.dataset.character === character) {
                    btn.classList.add('active', currentWork);
                }
            });
            showWelcomeMessage();
        }

        function renderCharacterButtons() {
            const characters = WORKS[currentWork].characters;
            characterSelect.innerHTML = '';
            Object.entries(characters).forEach(([key, char], index) => {
                const btn = document.createElement('button');
                btn.className = 'character-btn' + (index === 0 ? ` active ${currentWork}` : '');
                btn.dataset.character = key;
                btn.innerHTML = `${char.emoji} ${char.name}`;
                btn.addEventListener('click', () => switchCharacter(key));
                characterSelect.appendChild(btn);
            });
        }

        function renderQuickPrompts() {
            const prompts = WORKS[currentWork].quickPrompts;
            quickPromptsContainer.innerHTML = '';
            prompts.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'quick-prompt';
                btn.innerHTML = `${p.emoji} ${p.text}`;
                btn.addEventListener('click', () => {
                    userInput.value = p.prompt;
                    userInput.dataset.promptKey = p.key;
                    sendMessage();
                });
                quickPromptsContainer.appendChild(btn);
            });
        }

        function showWelcomeMessage() {
            const char = WORKS[currentWork].characters[currentCharacter];
            chatMessages.innerHTML = `
                <div class="message bot">
                    <div class="sender">${char.emoji} ${char.name}</div>
                    <div class="content">${char.welcome}</div>
                </div>
            `;
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            const promptKey = userInput.dataset.promptKey || '';
            if (!message || isWaiting) return;
            
            isWaiting = true;
            sendBtn.disabled = true;
            userInput.value = '';
            userInput.dataset.promptKey = '';
            
            addMessage('user', message);
            typingIndicator.classList.add('show');
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            try {
                let reply;
                
                if (USE_MOCK) {
                    // æ¨¡æ“¬å›æ‡‰
                    await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));
                    const char = WORKS[currentWork].characters[currentCharacter];
                    reply = char.mockResponses[promptKey] || char.mockResponses.default;
                } else {
                    // çœŸå¯¦ API
                    const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message, character: currentCharacter, history: conversationHistory })
                    });
                    const data = await response.json();
                    reply = data.reply || 'æŠ±æ­‰ï¼Œæˆ‘ç¾åœ¨æœ‰é»ç´¯äº†ã€‚';
                }
                
                conversationHistory.push({ role: 'user', content: message });
                conversationHistory.push({ role: 'assistant', content: reply });
                
                const char = WORKS[currentWork].characters[currentCharacter];
                addMessage('bot', reply, `${char.emoji} ${char.name}`);
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('bot', 'æŠ±æ­‰ï¼Œå‡ºäº†é»å•é¡Œã€‚è«‹ç¨å¾Œå†è©¦ã€‚', 'âš ï¸ ç³»çµ±');
            } finally {
                isWaiting = false;
                sendBtn.disabled = false;
                typingIndicator.classList.remove('show');
            }
        }

        function addMessage(type, content, sender = '') {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            div.innerHTML = `
                ${sender ? `<div class="sender">${sender}</div>` : ''}
                <div class="content">${content}</div>
            `;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        init();
    </script>
</body>
</html>
